<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="shared-styles.html">
<link rel="import" href="../bower_components/iron-list/iron-list.html">
<link rel="import" href="../bower_components/isw-dialog/isw-dialog.html">
<link rel="import" href="../bower_components/isw-dialog/isw-dialog-remote.html">
<link rel="import" href="../bower_components/show-more/show-more.html">
<link rel="import" href="../bower_components/show-more/show-more.html">

<link rel="import" href="../bower_components/app-storage/app-indexeddb-mirror/app-indexeddb-mirror.html">
<link rel="import" href="../bower_components/polymerfire/polymerfire.html">
<link rel="import" href="../bower_components/polymerfire/firebase-app.html">




<link rel="import" href="devocional-editor.html">
<link rel="import" href="devocional-item.html">

<dom-module id="devocional-view">
  <template>
    <style include="shared-styles">
      :host {
        display: block;

        padding: 10px;
      }
    </style>

   <!-- <devocional-editor name="editor">
    </devocional-editor>-->
    <dom-repeat items="[[devocionalItems]]" >
        <template>
            <devocional-item id="{{item.index}}" 
            index="{{item.index}}" 
            date="[[item.date]]" 
            book="[[item.book]]" 
            chapter="[[item.chapter]]" 
            is-selected="{{item.selected}}" 
            on-selected="itemSelected" 
            on-delete="deleteItem">
              </devocional-item>
          </template>
      </dom-repeat>
    
      <isw-dialog-remote
        id="dialogRemote"
        dialog="deleteDialog"
        data="{{dataForDialog}}"
        on-iron-overlay-canceled="_canceled"
        on-iron-overlay-closed="_closed"
        on-iron-overlay-opened="_opened">
      </isw-dialog-remote>
      
  </template>

  <script>
    class DevocionalView extends Polymer.Element {
      static get is() { return 'devocional-view'; }
      static get properties(){
                return {
                 lastSelected:{
                    type: Object
                 },
                 lastId:{
                 	type:String
                 },
                 devocionalItems:{
                    type: Array,
                    value:[{date:"01/04/2017"},{date:"10/05/2018", book:"S.Juan",chapter:"2"},{date:"test"},{date:"10/05/2018", book:"S.Juan",chapter:"2"}]
                    }
                 
                 
               
        };
        }
      ready(){
      	super.ready();
          
      
      }
      itemSelected(e){ 
      	if(this.lastSelected !== e.model && this.lastSelected){
      	  this.lastSelected.set('item.selected',false);
            // this.lastSelected.set('item.date',"date");
          }
      	this.lastSelected = e.model;
      }
      deleteItem(e){
          console.log("view delete "+e.target.date +"index"+e.model.index);
          console.log( "opening remote" );
          this.dataForDialog={"date":e.target.date,"index":e.model.index};
				this.$.dialogRemote.open();
      }
      openRemote() {
				console.log( "opening remote" );
                this.dataForDialog={"date":this.date,"index":this.index};
				this.$.dialogRemote.open();
			}
			
      _canceled( event ) {
						console.log( "canceled");
					}

			_closed( event ) {
            console.debug("canceled "+ event.target.data.canceled);
            if(event.target.data.canceled){
              console.debug("canceled ")

            }else{
              var index=event.target.data.index;
              var item=this.devocionalItems[index];
              item.date="aaaa";
              this.splice('devocionalItems', index, 1,{date:item.date,book:item.book,chapter:item.chapter});
              console.log( "closed" );
              console.log(this.devocionalItems[index]);
                          
              console.log( event.target.data.index + " deleted");
              }
            
                       
					}

					_opened( event ) {
						//console.log( "opened" );
                        }
    }

    window.customElements.define(DevocionalView.is, DevocionalView);
  </script>
</dom-module>